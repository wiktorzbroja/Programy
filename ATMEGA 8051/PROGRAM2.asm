MOV R1, #50D
MOV R2, #250D
DEC R5
E SET P3.4
RS SET P3.5
LJMP INIT
ORG 0023H
LJMP PRZE


ORG 100H
INIT:
	MOV SCON, #00001010B
	MOV TMOD, #00100000B
	MOV TH1, #0FDH
	MOV TCON, #01000100B
	SETB EA
	SETB ES
	
	CALL FUNCTION_SET
	CALL DISPLAY_OFF
	CALL DISPLAY_CLR
	CALL ENTR_MOD_SET
	CALL DISPLAY_ON
	
	LJMP MAIN

MAIN:
INC R7
LJMP MAIN

FUNCTION_SET:
	SETB E
	CLR RS
	MOV P1, #00111000B;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
RET

DISPLAY_OFF:
	SETB E
	CLR RS
	MOV P1, #00001000B;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
RET

DISPLAY_CLR:
	SETB E
	CLR RS
	MOV P1,#000000001 ;DONE
	CLR E
	MOV R2, #250D
	CALL SLEEP2000
RET

ENTR_MOD_SET:
	SETB E
	CLR RS
	MOV P1,#00000110B ;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
RET

DISPLAY_ON:
	SETB E
	CLR RS
	MOV P1,#00001111B;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
RET

DDRAM_SET:
	SETB E
	CLR RS
	MOV P1,#11000000B;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
RET

DDRAM_SET2:
	SETB E
	CLR RS
	MOV P1,#10000000B;DONE
	CLR E
	MOV R1, #50D
	CALL SLEEP50
DISP:
	SETB E
	SETB RS
	MOV P1, A
	CLR E
	MOV R1, #50D
	CALL SLEEP50
	INC R5
	CJNE R5,#10H,WYJSCIE
	CALL DDRAM_SET
	WYJSCIE:
	CJNE R5,#21H,WYJSCIE2
	MOV R5, #00H
	CALL DISPLAY_CLR
	CALL DDRAM_SET2
	WYJSCIE2:
	
RET

SLEEP50:	
	DJNZ R1, SLEEP50 
RET

SLEEP2000:
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
	DJNZ R2, SLEEP2000 
RET

PRZE:
;Umiescic ten kod w swoim programie 

;Procedura obslugi przerwania od portu szeregowego
	MOV A, SBUF
	MOV 50H, A 	; Pod adresem 50H w internal RAM znajdzie sie kod nacisnietego znaku
	MOV SBUF, A
	CJNE A,#03H,KONT
	CALL DISPLAY_CLR
	CALL DDRAM_SET2
	MOV R5,#01H
	KONT:
	CALL DISP
	CLR TI
	CLR RI
	
RETI


END